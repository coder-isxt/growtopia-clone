<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Growtopia Test</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="authScreen" class="auth-screen">
    <div class="auth-card">
      <h2>Account Login</h2>
      <input id="authUsername" type="text" maxlength="20" placeholder="Username">
      <input id="authPassword" type="password" maxlength="64" placeholder="Password">
      <div class="auth-actions">
        <button id="authCreateBtn" type="button">Create Account</button>
        <button id="authLoginBtn" type="button">Login</button>
      </div>
      <div id="authStatus" class="auth-status">Create or login to continue.</div>
    </div>
  </div>
  <div id="gameShell" class="game-shell hidden">
    <div class="hud">
      <div><strong>PIXELBUILD</strong> | Move: A/D or Arrows, Jump: W/Space</div>
      <div class="hint">
        World: <span id="currentWorldLabel" class="world-tag">menu</span> |
        Action: Click/Tap (Fist breaks, Wrench interacts, Right-click rotates) | Enter: Chat |
        <span id="networkState" class="danger">Offline</span> |
        <span id="onlineCount">1 world online</span> |
        <span id="totalOnlineCount">1 total online</span> |
        <button id="chatToggleBtn" type="button" class="hidden">Chat</button>
        <button id="adminToggleBtn" type="button" class="hidden">Admin</button>
        <button id="exitWorldBtn" type="button" class="hidden">Exit World</button>
        <button id="logoutBtn" type="button">Logout</button>
      </div>
    </div>
    <div id="menuScreen" class="menu-screen">
      <div class="menu-card">
        <h2 class="menu-title">World Menu</h2>
        <div id="worldButtons" class="world-buttons"></div>
        <div class="world-enter">
          <input id="worldInput" type="text" placeholder="enter world name">
          <button id="enterWorldBtn" type="button">Enter</button>
        </div>
      </div>
    </div>
    <div id="canvasWrap" class="canvas-wrap hidden">
      <canvas id="game" width="960" height="480" aria-label="Growtopia test game canvas"></canvas>
    </div>
    <div id="chatPanel" class="chat-panel hidden">
      <div id="chatMessages" class="chat-messages"></div>
      <div id="chatInputRow" class="chat-input-row hidden">
        <input id="chatInput" type="text" maxlength="120" placeholder="Type message...">
        <button id="chatSendBtn" type="button">Send</button>
      </div>
    </div>
    <div class="toolbar hidden" id="toolbar"></div>
    <div id="mobileControls" class="mobile-controls hidden">
      <div class="mobile-move">
        <button id="mobileLeftBtn" type="button">Left</button>
        <button id="mobileRightBtn" type="button">Right</button>
      </div>
      <div class="mobile-actions">
        <button id="mobileJumpBtn" type="button">Jump</button>
      </div>
    </div>
    <div id="adminPanel" class="admin-panel hidden">
      <div class="admin-header">
        <div class="admin-header-top">
          <strong>Admin Panel</strong>
          <div class="admin-header-actions">
            <button id="adminForceReloadBtn" type="button" class="hidden">Reload All</button>
            <button id="adminAuditExportBtn" type="button">Export Audit</button>
            <button id="adminCloseBtn" type="button">Close</button>
          </div>
        </div>
        <div class="admin-header-filters">
          <input id="adminSearchInput" type="text" placeholder="Search player/account">
          <select id="adminAuditActionFilter">
            <option value="">All actions</option>
          </select>
          <input id="adminAuditActorFilter" type="text" placeholder="Audit actor">
          <input id="adminAuditTargetFilter" type="text" placeholder="Audit target">
        </div>
      </div>
      <div id="adminAccounts" class="admin-accounts"></div>
    </div>
    <div id="adminInventoryModal" class="admin-inventory-modal hidden">
      <div class="admin-inventory-card">
        <div class="admin-inventory-header">
          <strong id="adminInventoryTitle">Inventory</strong>
          <button id="adminInventoryCloseBtn" type="button">Close</button>
        </div>
        <div id="adminInventoryBody" class="admin-inventory-body"></div>
      </div>
    </div>
    <div id="vendingModal" class="vending-modal hidden">
      <div class="vending-card">
        <div class="vending-header">
          <strong id="vendingTitle">Vending Machine</strong>
          <button id="vendingCloseBtn" type="button">Close</button>
        </div>
        <div id="vendingBody" class="vending-body"></div>
        <div id="vendingActions" class="vending-actions"></div>
      </div>
    </div>
    <div id="signModal" class="vending-modal hidden">
      <div class="vending-card sign-card">
        <div class="vending-header">
          <strong id="signTitle">Sign</strong>
          <button id="signCloseBtn" type="button">Close</button>
        </div>
        <div class="sign-body">
          <textarea id="signTextInput" maxlength="120" placeholder="Enter sign text..."></textarea>
          <div class="sign-hint">Shown when standing on top of this sign.</div>
        </div>
        <div class="vending-actions">
          <button id="signSaveBtn" type="button">Save</button>
        </div>
      </div>
    </div>
    <div id="updatingOverlay" class="updating-overlay hidden" aria-live="polite">
      <div class="updating-card">
        <div class="updating-title">Updating...</div>
        <div class="updating-subtitle">New version is being applied. Please wait.</div>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-database-compat.js"></script>
  <script>
    (function () {
      const params = new URLSearchParams(window.location.search || "");
      const queryVersion = (params.get("v") || "").trim();
      let assetVersion = queryVersion;
      if (!assetVersion) {
        try {
          assetVersion = (localStorage.getItem("gt_asset_version") || "").trim();
        } catch (error) {
          assetVersion = "";
        }
      }
      if (!assetVersion) {
        assetVersion = "dev";
      }
      try {
        localStorage.setItem("gt_asset_version", assetVersion);
      } catch (error) {
        // ignore localStorage write failures
      }
      window.GT_ASSET_VERSION = assetVersion;
      const versionedFiles = [
        "firebase-config.js",
        "settings.js",
        "admin.js",
        "blocks.js",
        "block_keys.js",
        "items.js",
        "player.js",
        "auth_storage.js",
        "world.js",
        "physics.js",
        "animations.js",
        "sync_player.js",
        "sync_blocks.js",
        "sync_worlds.js",
        "vending.js",
        "chat.js",
        "menu.js",
        "game.js"
      ];
      function loadScriptAt(index) {
        if (index >= versionedFiles.length) return;
        const script = document.createElement("script");
        script.src = versionedFiles[index] + "?v=" + encodeURIComponent(assetVersion);
        script.onload = function () { loadScriptAt(index + 1); };
        script.onerror = function () { loadScriptAt(index + 1); };
        document.body.appendChild(script);
      }
      loadScriptAt(0);
    })();
  </script>
</body>
</html>
